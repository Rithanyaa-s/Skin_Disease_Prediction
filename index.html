{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center">
  <div class="col-12 col-lg-10">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <div class="d-flex align-items-center gap-3 mb-3">
          <div class="icon-circle bg-gradient-primary">
            <span class="material-symbols-outlined">upload</span>
          </div>
          <div>
            <h1 class="h4 mb-1">Upload a skin lesion image</h1>
            <p class="text-secondary mb-0">JPG, JPEG, or PNG â€¢ Max 10 MB</p>
          </div>
        </div>

        <form id="uploadForm" class="mt-3" action="{{ url_for('index') }}" method="post" enctype="multipart/form-data">
          <div id="dropZone" class="drop-zone">
            <input id="fileInput" class="visually-hidden" type="file" name="photo" accept=".jpg,.jpeg,.png" required>
            <div class="dz-inner text-center">
              <p class="mb-1 fw-semibold">Drag & drop image here</p>
              <p class="text-secondary small mb-2">or</p>
              <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Browse Files</button>
              <p id="fileName" class="small text-secondary mt-2"></p>
            </div>
          </div>

          <!-- Preview -->
          <div id="previewWrapper" class="mt-4 d-none">
            <h2 class="h6 text-secondary">Preview</h2>
            <div class="preview-box">
              <img id="previewImage" alt="Preview">
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button id="submitBtn" class="btn btn-success" type="submit" disabled>Predict</button>
            <button class="btn btn-outline-secondary" type="button" id="clearBtn">Clear</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  const dropZone   = document.getElementById('dropZone');
  const fileInput  = document.getElementById('fileInput');
  const fileName   = document.getElementById('fileName');
  const preview    = document.getElementById('previewImage');
  const previewWrap= document.getElementById('previewWrapper');
  const submitBtn  = document.getElementById('submitBtn');
  const clearBtn   = document.getElementById('clearBtn');

  function setFile(file) {
    if (!file) return;
    fileName.textContent = file.name;
    submitBtn.disabled = false;

    const reader = new FileReader();
    reader.onload = e => {
      preview.src = e.target.result;
      previewWrap.classList.remove('d-none');
    };
    reader.readAsDataURL(file);
  }

  // Drag & drop
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
  });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const f = e.dataTransfer.files[0];
    if (f) {
      fileInput.files = e.dataTransfer.files; // pass to form
      setFile(f);
    }
  });

  // Browse
  fileInput.addEventListener('change', (e) => setFile(e.target.files[0]));

  // Clear
  clearBtn.addEventListener('click', () => {
    fileInput.value = '';
    fileName.textContent = '';
    submitBtn.disabled = true;
    preview.src = '';
    previewWrap.classList.add('d-none');
  });
</script>
{% endblock %}
